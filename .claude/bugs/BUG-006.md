---
id: BUG-006
title: Security audit prompts for bash script permission despite allowed-tools
status: fixed
priority: high
created: 2025-12-16T12:25:00
updated: 2025-12-16T12:30:00
reporter: user
tags: [security, permissions, bash]
related-files:
  - plugins/security/agents/audit-orchestrator.md
  - plugins/security/commands/security.md
  - plugins/security/skills/project-context/SKILL.md
---

# BUG-006: Security audit prompts for bash script permission despite allowed-tools

## Description

When running `/security:audit quick`, the user is prompted to approve running `build-project-context.sh`:

```
Bash command
   /Users/zberg/.claude/plugins/cache/cc-plugins/security/1.2.1/scripts/build-project-context.sh
   Generate project context for security audit

Do you want to proceed?
```

This should not require user approval if the script is part of the plugin and properly configured.

## Expected Behavior

The `build-project-context.sh` script should run without prompting since:
1. It's part of the security plugin
2. It's a read-only discovery script
3. Users have already installed/trusted the plugin

## Actual Behavior

User is prompted every time the script needs to run.

## Context

- Discovered during: security audit on duplicate-tab-closer project
- Severity: UX friction - interrupts audit workflow
- Blocking: no (user can approve manually)

## Suggested Fix

Options to consider:
1. Add specific Bash pattern to allowed-tools: `Bash(${CLAUDE_PLUGIN_ROOT}/scripts/*:*)`
2. Replace bash script with Read/Glob tools to detect project context
3. Use the `Skill: project-context` instead of the bash script (already updated in orchestrator)

The orchestrator was already updated to use the Read tool and Skill instead of `cat`, but may still reference the bash script somewhere.

## Related

- BUG-003: Security agents need Write tool for reports (similar permission issue)

## Resolution

- **Fixed in**: commit pending (1.2.2)
- **Fixed by**: agent
- **Fix summary**:
  - Removed bash script reference from `security.md` command
  - Updated `project-context/SKILL.md` to use Read/Glob/Grep instead of bash script
  - Removed Bash from `security.md` allowed-tools since no longer needed
