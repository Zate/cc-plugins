---
name: vulnerability-patterns
description: Language-specific vulnerability detection patterns for security scanning and live validation. Provides regex patterns, grep commands, and detection strategies for common security vulnerabilities across multiple languages.
---

# Vulnerability Patterns

Structured patterns for detecting common security vulnerabilities during code analysis and real-time validation.

## When to Use This Skill

- **Live security hooks** - Real-time validation of code changes
- **Quick vulnerability scans** - Fast pattern-based detection
- **Building auditor agents** - Patterns for domain-specific audits
- **Custom security rules** - Extending detection capabilities

## When NOT to Use This Skill

- **Full security audits** - Use domain auditor agents instead
- **ASVS compliance checks** - Use asvs-requirements skill
- **Remediation guidance** - Use remediation-library skill

---

## Pattern Categories

| Category | Languages | OWASP | ASVS |
|----------|-----------|-------|------|
| Injection | All | A03 | V1 |
| Authentication | All | A07 | V6 |
| Cryptography | All | A02 | V11 |
| Secrets | All | A02 | V13 |
| XSS | JS/TS | A03 | V3 |
| Deserialization | Python, Java, PHP | A08 | V1 |
| Path Traversal | All | A01 | V5 |
| Command Injection | All | A03 | V1 |
| SSRF | All | A10 | V12 |

---

## Universal Patterns (All Languages)

### Hardcoded Secrets

**Detection Pattern**:
```regex
# API Keys
(?i)(api[_-]?key|apikey)\s*[:=]\s*['"][a-zA-Z0-9]{16,}['"]

# AWS Keys
(?:AKIA|ABIA|ACCA|ASIA)[A-Z0-9]{16}

# Private Keys
-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----

# Generic Secrets
(?i)(password|secret|token|credential)s?\s*[:=]\s*['"][^'"]{8,}['"]

# JWT Secrets
(?i)(jwt[_-]?secret|signing[_-]?key)\s*[:=]\s*['"][^'"]+['"]
```

**Grep Commands**:
```bash
# API keys
grep -rn --include="*.{js,ts,py,java,go,rb}" -E "(api[_-]?key|apikey)\s*[:=]\s*['\"][a-zA-Z0-9]{16,}['\"]" .

# AWS keys
grep -rn -E "AKIA[A-Z0-9]{16}" .

# Private keys
grep -rn "BEGIN.*PRIVATE KEY" .

# Password assignments
grep -rn --include="*.{js,ts,py,java,go,rb}" -E "(password|secret)\s*[:=]\s*['\"][^'\"]{8,}['\"]" .
```

**Severity**: High
**ASVS**: V13.3.1 - Secrets not in version control
**CWE**: CWE-798 (Hardcoded Credentials)

---

### SQL Injection

**Detection Pattern**:
```regex
# String concatenation in queries
(?i)(SELECT|INSERT|UPDATE|DELETE|FROM|WHERE).*\+\s*[a-zA-Z_]+

# f-string/template queries
(?i)f['"](SELECT|INSERT|UPDATE|DELETE).*\{

# Format string queries
(?i)(SELECT|INSERT|UPDATE|DELETE).*%\s*\(

# String interpolation
(?i)(SELECT|INSERT|UPDATE|DELETE).*\$\{
```

**Grep Commands**:
```bash
# Python f-string SQL
grep -rn --include="*.py" -E "f['\"]SELECT.*\{|f['\"]INSERT.*\{|f['\"]UPDATE.*\{|f['\"]DELETE.*\{" .

# JavaScript template SQL
grep -rn --include="*.{js,ts}" -E "\`SELECT.*\$\{|\`INSERT.*\$\{|\`UPDATE.*\$\{|\`DELETE.*\$\{" .

# String concatenation SQL (all languages)
grep -rn -E "(SELECT|INSERT|UPDATE|DELETE).*\+.*\+" .
```

**Severity**: Critical
**ASVS**: V1.2.1 - Parameterized queries
**CWE**: CWE-89 (SQL Injection)

---

### Command Injection

**Detection Pattern**:
```regex
# Shell execution with variables
(?i)(os\.system|subprocess\.call|exec|shell_exec|system)\s*\([^)]*\+
(?i)(os\.system|subprocess\.call|exec|shell_exec|system)\s*\([^)]*\$\{
(?i)(os\.system|subprocess\.call|exec|shell_exec|system)\s*\([^)]*f['"]

# Dangerous shell=True
subprocess\.[a-z]+\([^)]*shell\s*=\s*True
```

**Grep Commands**:
```bash
# Python os.system
grep -rn --include="*.py" -E "os\.system\s*\(.*\+" .

# Python subprocess shell=True
grep -rn --include="*.py" "shell\s*=\s*True" .

# Node.js exec
grep -rn --include="*.{js,ts}" -E "exec\s*\(.*\+" .

# PHP system calls
grep -rn --include="*.php" -E "(system|exec|shell_exec|passthru)\s*\(" .
```

**Severity**: Critical
**ASVS**: V1.2.3 - OS command injection prevention
**CWE**: CWE-78 (OS Command Injection)

---

### Path Traversal

**Detection Pattern**:
```regex
# Direct path concatenation
(?i)(open|read|write|file|path)\s*\([^)]*\+.*\)
(?i)(open|read|write|file|path)\s*\([^)]*\$\{.*\)

# No path validation
os\.path\.join\s*\([^)]*,[^)]*\)(?!.*resolve|.*is_relative)
```

**Grep Commands**:
```bash
# Python file operations with variables
grep -rn --include="*.py" -E "open\s*\(.*\+" .

# Node.js file operations
grep -rn --include="*.{js,ts}" -E "(readFile|writeFile|createReadStream)\s*\(.*\+" .

# Check for missing path validation
grep -rn --include="*.py" "os\.path\.join" . | grep -v "resolve\|is_relative"
```

**Severity**: High
**ASVS**: V5.4.1 - Path traversal prevention
**CWE**: CWE-22 (Path Traversal)

---

## JavaScript/TypeScript Patterns

### Dangerous eval()

**Detection Pattern**:
```regex
# eval with variables
eval\s*\([^)]*[a-zA-Z_]+[^)]*\)

# Function constructor
new\s+Function\s*\([^)]*[a-zA-Z_]+

# setTimeout/setInterval with string
(setTimeout|setInterval)\s*\([^,)]*['"`]
```

**Grep Commands**:
```bash
grep -rn --include="*.{js,ts}" -E "eval\s*\(" .
grep -rn --include="*.{js,ts}" -E "new\s+Function\s*\(" .
grep -rn --include="*.{js,ts}" -E "(setTimeout|setInterval)\s*\(['\"\`]" .
```

**Severity**: Critical
**ASVS**: V1.5.1 - Safe deserialization
**CWE**: CWE-94 (Code Injection)

---

### XSS via DOM Manipulation

**Detection Pattern**:
```regex
# innerHTML assignment
\.innerHTML\s*=(?!\s*['"]<[^>]+>[^<]*</[^>]+>['"])

# document.write
document\.write\s*\(

# insertAdjacentHTML
\.insertAdjacentHTML\s*\(

# React dangerouslySetInnerHTML
dangerouslySetInnerHTML
```

**Grep Commands**:
```bash
grep -rn --include="*.{js,ts,jsx,tsx}" "\.innerHTML\s*=" .
grep -rn --include="*.{js,ts,jsx,tsx}" "document\.write" .
grep -rn --include="*.{js,ts,jsx,tsx}" "dangerouslySetInnerHTML" .
```

**Severity**: High
**ASVS**: V3.3.1 - XSS prevention
**CWE**: CWE-79 (Cross-site Scripting)

---

### Prototype Pollution

**Detection Pattern**:
```regex
# Direct __proto__ access
__proto__

# Object merge without validation
Object\.assign\s*\([^)]*,[^)]*\)
\.\.\.(?!props)[a-zA-Z_]+

# Bracket notation with variable
\[[a-zA-Z_]+\]\s*=
```

**Grep Commands**:
```bash
grep -rn --include="*.{js,ts}" "__proto__" .
grep -rn --include="*.{js,ts}" "constructor\s*\[" .
```

**Severity**: High
**ASVS**: V1.5.1 - Safe deserialization
**CWE**: CWE-1321 (Prototype Pollution)

---

### Insecure Randomness

**Detection Pattern**:
```regex
Math\.random\s*\(\)
```

**Context**: Only flag when used for security purposes (tokens, keys, IDs)

**Grep Commands**:
```bash
grep -rn --include="*.{js,ts}" "Math\.random" .
```

**Severity**: Medium (context-dependent)
**ASVS**: V11.3.1 - CSPRNG for security values
**CWE**: CWE-330 (Insufficient Randomness)

---

### Missing Security Headers (Express)

**Detection Pattern**:
```regex
# Express without helmet
app\s*=\s*express\s*\(\)(?!.*helmet)

# Missing CSP
Content-Security-Policy(?!.*\S)
```

**Grep Commands**:
```bash
grep -rn --include="*.{js,ts}" "express()" . | grep -v helmet
grep -rn --include="*.{js,ts}" "helmet" .
```

**Severity**: Medium
**ASVS**: V3.4.1 - Security headers
**CWE**: CWE-693 (Protection Mechanism Failure)

---

## Python Patterns

### Unsafe Deserialization

**Detection Pattern**:
```regex
# Pickle with untrusted data
pickle\.(loads?|load)\s*\(

# YAML unsafe load
yaml\.(load|unsafe_load)\s*\([^)]*(?!Loader\s*=\s*yaml\.SafeLoader)

# Marshal load
marshal\.loads?\s*\(
```

**Grep Commands**:
```bash
grep -rn --include="*.py" "pickle\.load" .
grep -rn --include="*.py" "yaml\.load" . | grep -v "SafeLoader\|safe_load"
grep -rn --include="*.py" "marshal\.load" .
```

**Severity**: Critical
**ASVS**: V1.5.1 - Safe deserialization
**CWE**: CWE-502 (Deserialization of Untrusted Data)

---

### Weak Cryptography

**Detection Pattern**:
```regex
# MD5/SHA1 for security
hashlib\.(md5|sha1)\s*\(

# DES/RC4
DES\.|RC4\.|Blowfish\.

# ECB mode
\.MODE_ECB
```

**Grep Commands**:
```bash
grep -rn --include="*.py" "hashlib\.md5\|hashlib\.sha1" .
grep -rn --include="*.py" "MODE_ECB" .
grep -rn --include="*.py" -E "DES\.|RC4\." .
```

**Severity**: High
**ASVS**: V11.5.2 - No MD5/SHA1
**CWE**: CWE-327 (Broken Crypto Algorithm)

---

### Insecure Random

**Detection Pattern**:
```regex
# random module for security
random\.(choice|randint|random|randrange|sample)\s*\(
```

**Context**: Flag when used for tokens, keys, session IDs

**Grep Commands**:
```bash
grep -rn --include="*.py" -E "random\.(choice|randint|random|randrange)" . | grep -i "token\|key\|session\|secret\|password"
```

**Severity**: High
**ASVS**: V11.3.1 - CSPRNG
**CWE**: CWE-338 (Weak PRNG)

---

### Hardcoded Flask Secret Key

**Detection Pattern**:
```regex
SECRET_KEY\s*=\s*['"][^'"]+['"]
app\.secret_key\s*=\s*['"][^'"]+['"]
```

**Grep Commands**:
```bash
grep -rn --include="*.py" "SECRET_KEY\s*=\s*['\"]" .
grep -rn --include="*.py" "secret_key\s*=\s*['\"]" .
```

**Severity**: High
**ASVS**: V13.3.1 - Secrets management
**CWE**: CWE-798 (Hardcoded Credentials)

---

### Debug Mode in Production

**Detection Pattern**:
```regex
DEBUG\s*=\s*True
app\.run\s*\([^)]*debug\s*=\s*True
FLASK_DEBUG\s*=\s*['"]?1
```

**Grep Commands**:
```bash
grep -rn --include="*.py" "DEBUG\s*=\s*True" .
grep -rn --include="*.py" "debug\s*=\s*True" .
```

**Severity**: High
**ASVS**: V13.2.1 - Debug disabled in production
**CWE**: CWE-489 (Active Debug Code)

---

### TLS Verification Disabled

**Detection Pattern**:
```regex
verify\s*=\s*False
REQUESTS_CA_BUNDLE\s*=\s*['"]?$
urllib3\.disable_warnings
```

**Grep Commands**:
```bash
grep -rn --include="*.py" "verify\s*=\s*False" .
grep -rn --include="*.py" "disable_warnings" .
```

**Severity**: High
**ASVS**: V12.3.1 - Certificate validation
**CWE**: CWE-295 (Improper Certificate Validation)

---

## Go Patterns

### SQL Injection

**Detection Pattern**:
```regex
# fmt.Sprintf in queries
fmt\.Sprintf\s*\([^)]*SELECT
db\.(Query|Exec)\s*\([^)]*\+

# String concatenation
"SELECT.*"\s*\+
```

**Grep Commands**:
```bash
grep -rn --include="*.go" -E "fmt\.Sprintf.*SELECT|fmt\.Sprintf.*INSERT" .
grep -rn --include="*.go" -E "db\.(Query|Exec)\s*\(.*\+" .
```

**Severity**: Critical
**ASVS**: V1.2.1 - Parameterized queries
**CWE**: CWE-89 (SQL Injection)

---

### Weak Cryptography

**Detection Pattern**:
```regex
crypto/md5
crypto/sha1
crypto/des
crypto/rc4
```

**Grep Commands**:
```bash
grep -rn --include="*.go" "crypto/md5\|crypto/sha1\|crypto/des\|crypto/rc4" .
```

**Severity**: High
**ASVS**: V11.5.2 - No deprecated algorithms
**CWE**: CWE-327 (Broken Crypto)

---

### Insecure TLS Config

**Detection Pattern**:
```regex
InsecureSkipVerify\s*:\s*true
MinVersion\s*:\s*tls\.VersionSSL
MinVersion\s*:\s*tls\.VersionTLS10
```

**Grep Commands**:
```bash
grep -rn --include="*.go" "InsecureSkipVerify.*true" .
grep -rn --include="*.go" "MinVersion.*SSL\|MinVersion.*TLS10\|MinVersion.*TLS11" .
```

**Severity**: High
**ASVS**: V12.2.1 - TLS 1.2+
**CWE**: CWE-295 (Certificate Validation)

---

## Java Patterns

### SQL Injection

**Detection Pattern**:
```regex
# String concatenation
Statement\s+\w+\s*=.*createStatement
executeQuery\s*\([^?]*\+
"SELECT.*"\s*\+

# PreparedStatement misuse
prepareStatement\s*\([^?]*\+
```

**Grep Commands**:
```bash
grep -rn --include="*.java" "createStatement" .
grep -rn --include="*.java" -E "executeQuery\s*\(.*\+" .
grep -rn --include="*.java" -E "\"SELECT.*\"\s*\+" .
```

**Severity**: Critical
**ASVS**: V1.2.1 - Parameterized queries
**CWE**: CWE-89 (SQL Injection)

---

### Unsafe Deserialization

**Detection Pattern**:
```regex
ObjectInputStream
readObject\s*\(\)
XMLDecoder
XStream(?!.*allowTypes)
```

**Grep Commands**:
```bash
grep -rn --include="*.java" "ObjectInputStream\|readObject()" .
grep -rn --include="*.java" "XMLDecoder" .
```

**Severity**: Critical
**ASVS**: V1.5.1 - Safe deserialization
**CWE**: CWE-502 (Deserialization)

---

### XXE Vulnerability

**Detection Pattern**:
```regex
DocumentBuilderFactory(?!.*setFeature.*FEATURE_SECURE)
SAXParserFactory(?!.*setFeature)
XMLInputFactory(?!.*setProperty.*SUPPORT_DTD)
```

**Grep Commands**:
```bash
grep -rn --include="*.java" "DocumentBuilderFactory\|SAXParserFactory\|XMLInputFactory" .
```

**Severity**: High
**ASVS**: V1.5.1 - XML processing
**CWE**: CWE-611 (XXE)

---

### Weak Cryptography

**Detection Pattern**:
```regex
MessageDigest\.getInstance\s*\(\s*["']MD5
MessageDigest\.getInstance\s*\(\s*["']SHA-?1
Cipher\.getInstance\s*\(\s*["']DES
Cipher\.getInstance\s*\(\s*["'].*ECB
```

**Grep Commands**:
```bash
grep -rn --include="*.java" -E "MessageDigest\.getInstance.*MD5|MessageDigest\.getInstance.*SHA.?1" .
grep -rn --include="*.java" "Cipher\.getInstance.*DES\|Cipher\.getInstance.*ECB" .
```

**Severity**: High
**ASVS**: V11.5.2 - Secure algorithms
**CWE**: CWE-327 (Broken Crypto)

---

## Ruby Patterns

### Command Injection

**Detection Pattern**:
```regex
`[^`]*#{
system\s*\([^)]*#{
exec\s*\([^)]*#{
%x\{[^}]*#{
```

**Grep Commands**:
```bash
grep -rn --include="*.rb" -E "\`.*#\{" .
grep -rn --include="*.rb" -E "system\s*\(.*#\{" .
grep -rn --include="*.rb" "%x{" .
```

**Severity**: Critical
**ASVS**: V1.2.3 - Command injection
**CWE**: CWE-78 (OS Command Injection)

---

### SQL Injection (Rails)

**Detection Pattern**:
```regex
\.where\s*\([^)]*#{
\.find_by_sql\s*\([^)]*#{
\.execute\s*\([^)]*#{
\.order\s*\([^)]*#{
```

**Grep Commands**:
```bash
grep -rn --include="*.rb" -E "\.where\s*\(.*#\{" .
grep -rn --include="*.rb" "find_by_sql" .
```

**Severity**: Critical
**ASVS**: V1.2.1 - Parameterized queries
**CWE**: CWE-89 (SQL Injection)

---

### Mass Assignment

**Detection Pattern**:
```regex
attr_accessible\s*:
params\.permit!
\.update_attributes?\s*\(params
```

**Grep Commands**:
```bash
grep -rn --include="*.rb" "params\.permit!" .
grep -rn --include="*.rb" "update_attributes.*params" .
```

**Severity**: High
**ASVS**: V2.2.1 - Input validation
**CWE**: CWE-915 (Mass Assignment)

---

## PHP Patterns

### SQL Injection

**Detection Pattern**:
```regex
mysql_query\s*\(
mysqli_query\s*\([^,]+,\s*["'][^?]
\$_(?:GET|POST|REQUEST)\s*\[.*\]\s*\.
```

**Grep Commands**:
```bash
grep -rn --include="*.php" "mysql_query\|mysqli_query" .
grep -rn --include="*.php" '\$_(GET|POST|REQUEST).*\.' .
```

**Severity**: Critical
**ASVS**: V1.2.1 - Parameterized queries
**CWE**: CWE-89 (SQL Injection)

---

### Command Injection

**Detection Pattern**:
```regex
(system|exec|shell_exec|passthru|popen|proc_open)\s*\(\s*\$
`\$
```

**Grep Commands**:
```bash
grep -rn --include="*.php" -E "(system|exec|shell_exec|passthru)\s*\(\s*\\\$" .
```

**Severity**: Critical
**ASVS**: V1.2.3 - Command injection
**CWE**: CWE-78 (OS Command Injection)

---

### Unsafe Deserialization

**Detection Pattern**:
```regex
unserialize\s*\(\s*\$
```

**Grep Commands**:
```bash
grep -rn --include="*.php" "unserialize\s*(\s*\$" .
```

**Severity**: Critical
**ASVS**: V1.5.1 - Safe deserialization
**CWE**: CWE-502 (Deserialization)

---

### File Inclusion

**Detection Pattern**:
```regex
(include|require|include_once|require_once)\s*\(\s*\$
```

**Grep Commands**:
```bash
grep -rn --include="*.php" -E "(include|require)(_once)?\s*\(\s*\\\$" .
```

**Severity**: Critical
**ASVS**: V5.3.1 - File security
**CWE**: CWE-98 (File Inclusion)

---

## Configuration File Patterns

### .env Files

**Detection Pattern**:
```regex
# Sensitive keys in .env
(?i)(password|secret|token|api[_-]?key|private[_-]?key)\s*=\s*[^\s]+
```

**Grep Commands**:
```bash
grep -rn -E "(?i)(password|secret|token|api.?key)=" .env* 2>/dev/null
```

**Severity**: High
**ASVS**: V13.3.1 - Secrets management
**CWE**: CWE-798 (Hardcoded Credentials)

---

### Docker/Container

**Detection Pattern**:
```regex
# Privileged mode
--privileged
privileged:\s*true

# Running as root
USER\s+root

# Exposed secrets
ENV\s+(PASSWORD|SECRET|API_KEY|TOKEN)\s*=
```

**Grep Commands**:
```bash
grep -rn "privileged" Dockerfile docker-compose.yml 2>/dev/null
grep -rn "USER root" Dockerfile 2>/dev/null
grep -rn -E "ENV.*(PASSWORD|SECRET|API_KEY)" Dockerfile 2>/dev/null
```

**Severity**: High
**ASVS**: V13.2.1 - Secure configuration
**CWE**: CWE-250 (Excessive Privilege)

---

## Quick Scan Script

Use this script for rapid vulnerability detection:

```bash
#!/bin/bash
# quick-security-scan.sh

echo "=== Quick Security Scan ==="

echo -e "\n[1] Hardcoded Secrets"
grep -rn --include="*.{js,ts,py,java,go,rb,php}" -E "(api[_-]?key|password|secret)\s*[:=]\s*['\"][^'\"]{8,}['\"]" . 2>/dev/null | head -20

echo -e "\n[2] SQL Injection Patterns"
grep -rn --include="*.{js,ts,py,java,go,rb,php}" -E "(SELECT|INSERT|UPDATE|DELETE).*\+" . 2>/dev/null | head -20

echo -e "\n[3] Command Injection"
grep -rn --include="*.py" "shell\s*=\s*True" . 2>/dev/null
grep -rn --include="*.{js,ts}" -E "exec\s*\(|spawn\s*\(" . 2>/dev/null | head -10

echo -e "\n[4] Unsafe Deserialization"
grep -rn --include="*.py" "pickle\.load\|yaml\.load" . 2>/dev/null
grep -rn --include="*.java" "ObjectInputStream\|readObject" . 2>/dev/null

echo -e "\n[5] Weak Cryptography"
grep -rn --include="*.{py,java,go}" -E "md5|sha1|DES|RC4" . 2>/dev/null | head -10

echo -e "\n[6] Debug/Dev Settings"
grep -rn --include="*.py" "DEBUG\s*=\s*True" . 2>/dev/null
grep -rn "NODE_ENV.*development" . 2>/dev/null

echo -e "\n=== Scan Complete ==="
```

---

## Integration with Live Hooks

When using these patterns in PreToolUse hooks:

1. **Parse the file content** from the tool input
2. **Apply relevant patterns** based on file extension
3. **Return blocking result** for Critical/High severity matches
4. **Return warning** for Medium severity matches

### Pattern Matching Priority

| Severity | Action | Response Time |
|----------|--------|---------------|
| Critical | Block | Immediate |
| High | Block/Warn | Immediate |
| Medium | Warn | Deferred |
| Low | Log | Async |

### False Positive Mitigation

1. **Context awareness**: Check surrounding code for sanitization
2. **Allowlists**: Skip known-safe patterns (e.g., test files)
3. **Confidence scoring**: Multiple indicators increase confidence
4. **User overrides**: Allow explicit bypass with comments

---

## See Also

- `Skill: asvs-requirements` - Full ASVS requirement details
- `Skill: remediation-library` - Fix patterns for each vulnerability
- `Skill: project-context` - Detect applicable languages/frameworks
- `Agent: encoding-auditor` - Deep injection analysis
- `Agent: crypto-auditor` - Cryptography review
