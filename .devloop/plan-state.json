{
  "schema_version": "1.0.0",
  "plan_file": ".devloop/plan.md",
  "last_sync": "2025-12-27T01:00:26Z",
  "plan_name": "Devloop Plan: Structured Plan Format & Script-First Workflow",
  "status": "in_progress",
  "created": "2025-12-27",
  "updated": "00Z",
  "current_phase": 1,
  "stats": {
    "total": 28,
    "completed": 1,
    "pending": 27,
    "in_progress": 0,
    "blocked": 0,
    "skipped": 0,
    "done": 1,
    "percentage": 3
  },
  "phases": [
    {
      "number": 1,
      "name": "Core Infrastructure",
      "goal": "Create the sync mechanism and JSON state schema",
      "status": "in_progress",
      "task_ids": [
        "1.1",
        "1.2",
        "1.3",
        "1.4",
        "1.5"
      ],
      "stats": {
        "total": 5,
        "completed": 1,
        "pending": 4
      }
    },
    {
      "number": 2,
      "name": "Script Migration - High Value",
      "goal": "Convert highest-token operations to scripts",
      "status": "pending",
      "task_ids": [
        "2.1",
        "2.2",
        "2.3",
        "2.4",
        "2.5",
        "2.6"
      ],
      "stats": {
        "total": 6,
        "completed": 0,
        "pending": 6
      }
    },
    {
      "number": 3,
      "name": "Script Migration - Issue Tracking",
      "goal": "Make issue tracking mostly script-driven",
      "status": "pending",
      "task_ids": [
        "3.1",
        "3.2",
        "3.3",
        "3.4",
        "3.5",
        "3.6"
      ],
      "stats": {
        "total": 6,
        "completed": 0,
        "pending": 6
      }
    },
    {
      "number": 4,
      "name": "Command Simplification",
      "goal": "Reduce continue.md and other commands to thin wrappers",
      "status": "pending",
      "task_ids": [
        "4.1",
        "4.2",
        "4.3",
        "4.4",
        "4.5"
      ],
      "stats": {
        "total": 5,
        "completed": 0,
        "pending": 5
      }
    },
    {
      "number": 5,
      "name": "Documentation & Validation",
      "goal": "Document the new system and validate token savings",
      "status": "pending",
      "task_ids": [
        "5.1",
        "5.2",
        "5.3",
        "5.4",
        "5.5",
        "5.6"
      ],
      "stats": {
        "total": 6,
        "completed": 0,
        "pending": 6
      }
    }
  ],
  "tasks": {
    "1.1": {
      "id": "1.1",
      "description": "Define JSON schema for plan-state.json",
      "status": "complete",
      "phase": 1,
      "acceptance": "Schema file with all fields documented",
      "files": [
        "plugins/devloop/schemas/plan-state.schema.json"
      ]
    },
    "1.2": {
      "id": "1.2",
      "description": "Create sync-plan-state.sh script",
      "status": "pending",
      "phase": 1,
      "parallel_group": "A",
      "acceptance": "Parses plan.md, outputs valid JSON to plan-state.json",
      "files": [
        "plugins/devloop/scripts/sync-plan-state.sh"
      ],
      "notes": "Must handle all task markers: `[ ]`, `[x]`, `[~]`, `[!]`, `[-]`"
    },
    "1.3": {
      "id": "1.3",
      "description": "Create validate-plan-state.sh script",
      "status": "pending",
      "phase": 1,
      "parallel_group": "A",
      "acceptance": "Validates JSON against schema, reports errors",
      "files": [
        "plugins/devloop/scripts/validate-plan-state.sh"
      ]
    },
    "1.4": {
      "id": "1.4",
      "description": "Add sync trigger to session-start hook",
      "status": "pending",
      "phase": 1,
      "acceptance": "plan-state.json created/updated on session start",
      "files": [
        "plugins/devloop/hooks/session-start.sh"
      ],
      "depends_on": [
        "1.2"
      ]
    },
    "1.5": {
      "id": "1.5",
      "description": "Add sync trigger to pre-commit hook",
      "status": "pending",
      "phase": 1,
      "acceptance": "plan-state.json validated before commits",
      "files": [
        "plugins/devloop/hooks/pre-commit.sh"
      ],
      "depends_on": [
        "1.2"
      ]
    },
    "2.1": {
      "id": "2.1",
      "description": "Create fresh-start.sh to replace fresh.md logic",
      "status": "pending",
      "phase": 2,
      "parallel_group": "B",
      "acceptance": "Generates next-action.json without any LLM calls",
      "files": [
        "plugins/devloop/scripts/fresh-start.sh"
      ]
    },
    "2.2": {
      "id": "2.2",
      "description": "Update fresh.md to call fresh-start.sh",
      "status": "pending",
      "phase": 2,
      "acceptance": "Command is < 50 lines, only handles edge cases",
      "files": [
        "plugins/devloop/commands/fresh.md"
      ],
      "depends_on": [
        "2.1"
      ]
    },
    "2.3": {
      "id": "2.3",
      "description": "Create archive-interactive.sh",
      "status": "pending",
      "phase": 2,
      "parallel_group": "B",
      "acceptance": "Detects complete phases, performs archival, needs no LLM",
      "files": [
        "plugins/devloop/scripts/archive-interactive.sh"
      ]
    },
    "2.4": {
      "id": "2.4",
      "description": "Update archive.md to call archive-interactive.sh",
      "status": "pending",
      "phase": 2,
      "acceptance": "Command only handles user confirmation and errors",
      "files": [
        "plugins/devloop/commands/archive.md"
      ],
      "depends_on": [
        "2.3"
      ]
    },
    "2.5": {
      "id": "2.5",
      "description": "Update format-plan-status.sh to read from plan-state.json",
      "status": "pending",
      "phase": 2,
      "acceptance": "No markdown parsing, reads JSON directly",
      "files": [
        "plugins/devloop/scripts/format-plan-status.sh"
      ],
      "depends_on": [
        "1.2"
      ]
    },
    "2.6": {
      "id": "2.6",
      "description": "Update calculate-progress.sh to read from plan-state.json",
      "status": "pending",
      "phase": 2,
      "acceptance": "Falls back to parsing if JSON missing (backward compat)",
      "files": [
        "plugins/devloop/scripts/calculate-progress.sh"
      ],
      "depends_on": [
        "1.2"
      ]
    },
    "3.1": {
      "id": "3.1",
      "description": "Create create-issue.sh",
      "status": "pending",
      "phase": 3,
      "parallel_group": "C",
      "acceptance": "Creates BUG-NNN.md or FEAT-NNN.md with correct structure",
      "files": [
        "plugins/devloop/scripts/create-issue.sh"
      ]
    },
    "3.2": {
      "id": "3.2",
      "description": "Create list-issues.sh",
      "status": "pending",
      "phase": 3,
      "parallel_group": "C",
      "acceptance": "Lists issues with filtering (type, status), outputs markdown or JSON",
      "files": [
        "plugins/devloop/scripts/list-issues.sh"
      ]
    },
    "3.3": {
      "id": "3.3",
      "description": "Create update-issue.sh",
      "status": "pending",
      "phase": 3,
      "parallel_group": "C",
      "acceptance": "Updates issue status, adds comments",
      "files": [
        "plugins/devloop/scripts/update-issue.sh"
      ]
    },
    "3.4": {
      "id": "3.4",
      "description": "Update issues.md to use issue scripts",
      "status": "pending",
      "phase": 3,
      "acceptance": "Command reduced to routing + user questions",
      "files": [
        "plugins/devloop/commands/issues.md"
      ],
      "depends_on": [
        "3.1",
        "3.2",
        "3.3"
      ]
    },
    "3.5": {
      "id": "3.5",
      "description": "Update new.md to use create-issue.sh",
      "status": "pending",
      "phase": 3,
      "acceptance": "Only uses LLM for type detection when ambiguous",
      "files": [
        "plugins/devloop/commands/new.md"
      ],
      "depends_on": [
        "3.1"
      ]
    },
    "3.6": {
      "id": "3.6",
      "description": "Update bugs.md to use list-issues.sh",
      "status": "pending",
      "phase": 3,
      "acceptance": "Pure script invocation + display",
      "files": [
        "plugins/devloop/commands/bugs.md"
      ],
      "depends_on": [
        "3.2"
      ]
    },
    "4.1": {
      "id": "4.1",
      "description": "Extract task routing logic to select-next-task.sh",
      "status": "pending",
      "phase": 4,
      "acceptance": "Determines next task, respects dependencies/parallelism",
      "files": [
        "plugins/devloop/scripts/select-next-task.sh"
      ]
    },
    "4.2": {
      "id": "4.2",
      "description": "Extract plan display to show-plan-status.sh",
      "status": "pending",
      "phase": 4,
      "acceptance": "Renders plan progress without LLM",
      "files": [
        "plugins/devloop/scripts/show-plan-status.sh"
      ]
    },
    "4.3": {
      "id": "4.3",
      "description": "Simplify continue.md Step 1 (Find Plan)",
      "status": "pending",
      "phase": 4,
      "acceptance": "Uses detect-plan.sh and show-plan-status.sh",
      "files": [
        "plugins/devloop/commands/continue.md"
      ],
      "depends_on": [
        "4.2"
      ]
    },
    "4.4": {
      "id": "4.4",
      "description": "Simplify continue.md Step 2 (Parse Status)",
      "status": "pending",
      "phase": 4,
      "acceptance": "Uses select-next-task.sh for task selection",
      "files": [
        "plugins/devloop/commands/continue.md"
      ],
      "depends_on": [
        "4.1"
      ]
    },
    "4.5": {
      "id": "4.5",
      "description": "Update statusline to use plan-state.json",
      "status": "pending",
      "phase": 4,
      "acceptance": "Faster statusline rendering (no markdown parsing)",
      "files": [
        "plugins/devloop/statusline/devloop-statusline.sh"
      ],
      "depends_on": [
        "1.2"
      ]
    },
    "5.1": {
      "id": "5.1",
      "description": "Update plan-management skill with JSON state info",
      "status": "pending",
      "phase": 5,
      "acceptance": "Explains dual-file model, sync triggers",
      "files": [
        "plugins/devloop/skills/plan-management/SKILL.md"
      ]
    },
    "5.2": {
      "id": "5.2",
      "description": "Create migration guide for existing plans",
      "status": "pending",
      "phase": 5,
      "acceptance": "Step-by-step instructions for users",
      "files": [
        "plugins/devloop/docs/migration-to-json-state.md"
      ]
    },
    "5.3": {
      "id": "5.3",
      "description": "Add unit tests for sync-plan-state.sh",
      "status": "pending",
      "phase": 5,
      "acceptance": "Tests for all task markers, edge cases",
      "files": [
        "plugins/devloop/tests/sync-plan-state.bats"
      ]
    },
    "5.4": {
      "id": "5.4",
      "description": "Measure token usage before/after",
      "status": "pending",
      "phase": 5,
      "acceptance": "Document actual savings vs projected",
      "files": [
        ".devloop/spikes/structured-plan-format.md (update with results)"
      ]
    },
    "5.5": {
      "id": "5.5",
      "description": "Update CHANGELOG.md with new features",
      "status": "pending",
      "phase": 5,
      "acceptance": "Entry for structured state support",
      "files": [
        "plugins/devloop/CHANGELOG.md"
      ]
    },
    "5.6": {
      "id": "5.6",
      "description": "Bump version to reflect improvements",
      "status": "pending",
      "phase": 5,
      "acceptance": "Update plugin.json version",
      "files": [
        "plugins/devloop/.claude-plugin/plugin.json"
      ]
    }
  },
  "parallel_groups": {
    "A": [
      "1.2",
      "1.3"
    ],
    "B": [
      "2.1",
      "2.3"
    ],
    "C": [
      "3.1",
      "3.2",
      "3.3"
    ]
  },
  "dependencies": {
    "1.4": [
      "1.2"
    ],
    "1.5": [
      "1.2"
    ],
    "2.2": [
      "2.1"
    ],
    "2.4": [
      "2.3"
    ],
    "2.5": [
      "1.2"
    ],
    "2.6": [
      "1.2"
    ],
    "3.4": [
      "3.1",
      "3.2",
      "3.3"
    ],
    "3.5": [
      "3.1"
    ],
    "3.6": [
      "3.2"
    ],
    "4.3": [
      "4.2"
    ],
    "4.4": [
      "4.1"
    ],
    "4.5": [
      "1.2"
    ]
  },
  "next_task": "1.2"
}
